# æµ‹è¯•æ¡†æ¶æŠ€æœ¯å®ç°æ–‡æ¡£

## æ¶æ„è®¾è®¡

BitsButtonæµ‹è¯•æ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚æ¶æ„çš„Cè¯­è¨€æµ‹è¯•ç³»ç»Ÿï¼Œä¸“é—¨ä¸ºBitsButtonæŒ‰é”®åº“è®¾è®¡ã€‚æ¡†æ¶é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›å…¨é¢çš„æµ‹è¯•è¦†ç›–å’Œè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Šã€‚

### åˆ†å±‚ç»“æ„
```
test/
â”œâ”€â”€ Unity/                 # Unityæµ‹è¯•æ¡†æ¶
â”œâ”€â”€ core/                  # æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ
â”‚   â”œâ”€â”€ test_framework.h/c # æµ‹è¯•æ¡†æ¶åŸºç¡€è®¾æ–½
â”‚   â””â”€â”€ test_runner.h/c    # æµ‹è¯•è¿è¡Œå™¨å’ŒæŠ¥å‘Šç”Ÿæˆ
â”œâ”€â”€ utils/                 # æµ‹è¯•å·¥å…·åº“
â”‚   â”œâ”€â”€ mock_utils.h/c     # æ¨¡æ‹Ÿå·¥å…·
â”‚   â”œâ”€â”€ time_utils.h/c     # æ—¶é—´å·¥å…·
â”‚   â””â”€â”€ assert_utils.h/c   # æ–­è¨€å·¥å…·
â”œâ”€â”€ cases/                 # æµ‹è¯•ç”¨ä¾‹
â”‚   â”œâ”€â”€ basic/             # åŸºç¡€åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ combo/             # ç»„åˆæŒ‰é”®æµ‹è¯•
â”‚   â”œâ”€â”€ edge/              # è¾¹ç•Œæ¡ä»¶æµ‹è¯•
â”‚   â””â”€â”€ performance/       # æ€§èƒ½æµ‹è¯•
â”œâ”€â”€ config/                # æµ‹è¯•é…ç½®
â””â”€â”€ scripts/               # æ„å»ºè„šæœ¬
```

### æ ¸å¿ƒç»„ä»¶

#### 1. æµ‹è¯•æ¡†æ¶æ ¸å¿ƒ (core/)
- **test_framework.h/c**: æµ‹è¯•æ¡†æ¶åŸºç¡€è®¾æ–½
- **test_runner.h/c**: æµ‹è¯•è¿è¡Œå™¨å’ŒæŠ¥å‘Šç”Ÿæˆ

#### 2. æµ‹è¯•å·¥å…·åº“ (utils/)
- **mock_utils.h/c**: æ¨¡æ‹Ÿå·¥å…·ï¼Œæä¾›æŒ‰é”®çŠ¶æ€æ¨¡æ‹Ÿ
- **time_utils.h/c**: æ—¶é—´å·¥å…·ï¼Œå¤„ç†æ—¶åºæµ‹è¯•
- **assert_utils.h/c**: æ–­è¨€å·¥å…·ï¼Œæä¾›ä¸°å¯Œçš„éªŒè¯åŠŸèƒ½

#### 3. æµ‹è¯•ç”¨ä¾‹ (cases/)
- **basic/**: åŸºç¡€åŠŸèƒ½æµ‹è¯•ï¼ˆå•å‡»ã€åŒå‡»ã€é•¿æŒ‰ç­‰ï¼‰
- **combo/**: ç»„åˆæŒ‰é”®æµ‹è¯•ï¼ˆå¤šé”®ç»„åˆã€å†²çªå¤„ç†ï¼‰
- **edge/**: è¾¹ç•Œæ¡ä»¶æµ‹è¯•ï¼ˆè¶…æ—¶ã€æ¶ˆæŠ–ã€çŠ¶æ€æœºè¾¹ç•Œï¼‰
- **performance/**: æ€§èƒ½æµ‹è¯•ï¼ˆé«˜é¢‘å¤„ç†ã€å¹¶å‘ã€ç¨³å®šæ€§ï¼‰

## æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…

### åŸºç¡€åŠŸèƒ½æµ‹è¯• (7ä¸ª)
1. **test_single_click_event** - å•å‡»äº‹ä»¶æµ‹è¯•
2. **test_double_click_event** - åŒå‡»äº‹ä»¶æµ‹è¯•
3. **test_triple_click_event** - å¿«é€ŸåŒå‡»æµ‹è¯•
4. **test_long_press_event** - é•¿æŒ‰äº‹ä»¶æµ‹è¯•
5. **test_long_press_hold_event** - é•¿æŒ‰ä¿æŒæµ‹è¯•
6. **test_state_reset_functionality** - æŒ‰é”®çŠ¶æ€é‡ç½®åŠŸèƒ½æµ‹è¯•
7. **test_combo_button_reset** - ç»„åˆæŒ‰é”®çŠ¶æ€é‡ç½®æµ‹è¯•

### ç»„åˆæŒ‰é”®æµ‹è¯• (2ä¸ª)
1. **test_basic_combo_button** - åŸºæœ¬ç»„åˆæŒ‰é”®æµ‹è¯•
2. **test_combo_long_press** - ç»„åˆæŒ‰é”®é•¿æŒ‰æµ‹è¯•

### è¾¹ç•Œæ¡ä»¶æµ‹è¯• (5ä¸ª)
1. **test_slow_double_click_timeout** - è¶…æ—¶åŒå‡»æµ‹è¯•
2. **test_debounce_functionality** - æ¶ˆæŠ–åŠŸèƒ½æµ‹è¯•
3. **test_very_short_press** - æçŸ­æŒ‰é”®æµ‹è¯•
4. **test_long_press_boundary** - é•¿æŒ‰è¾¹ç•Œæµ‹è¯•
5. **test_rapid_clicks_boundary** - å¿«é€Ÿè¿å‡»è¾¹ç•Œæµ‹è¯•

### æ€§èƒ½æµ‹è¯• (4ä¸ª)
1. **test_high_frequency_button_presses** - é«˜é¢‘æŒ‰é”®å¤„ç†æµ‹è¯•
2. **test_multiple_buttons_concurrent** - å¤šæŒ‰é”®å¹¶å‘å¤„ç†æµ‹è¯•
3. **test_long_running_stability** - é•¿æ—¶é—´è¿è¡Œç¨³å®šæ€§æµ‹è¯•
4. **test_memory_usage** - å†…å­˜ä½¿ç”¨æµ‹è¯•

### ç¼“å†²åŒºæµ‹è¯• (3ä¸ª)
1. **test_buffer_overflow_protection** - ç¼“å†²åŒºæº¢å‡ºä¿æŠ¤æµ‹è¯•
2. **test_buffer_state_tracking** - ç¼“å†²åŒºçŠ¶æ€è·Ÿè¸ªæµ‹è¯•
3. **test_buffer_edge_cases** - ç¼“å†²åŒºè¾¹ç•Œæƒ…å†µæµ‹è¯•

### é«˜çº§ç»„åˆæµ‹è¯• (3ä¸ª)
1. **test_advanced_three_key_combo** - ä¸‰é”®ç»„åˆæµ‹è¯•
2. **test_combo_with_different_timing** - ä¸åŒæ—¶åºç»„åˆæµ‹è¯•
3. **test_multiple_combos_conflict** - å¤šç»„åˆé”®å†²çªæµ‹è¯•

### çŠ¶æ€æœºæµ‹è¯• (4ä¸ª)
1. **test_state_transition_timing** - çŠ¶æ€è½¬æ¢æ—¶åºæµ‹è¯•
2. **test_time_window_boundary** - æ—¶é—´çª—å£è¾¹ç•Œæµ‹è¯•
3. **test_long_press_period_boundary** - é•¿æŒ‰å‘¨æœŸè¾¹ç•Œæµ‹è¯•
4. **test_rapid_state_changes** - å¿«é€ŸçŠ¶æ€å˜åŒ–æµ‹è¯•

### é”™è¯¯å¤„ç†æµ‹è¯• (4ä¸ª)
1. **test_null_pointer_handling** - ç©ºæŒ‡é’ˆå¤„ç†æµ‹è¯•
2. **test_invalid_parameters** - æ— æ•ˆå‚æ•°æµ‹è¯•
3. **test_boundary_values** - è¾¹ç•Œå€¼æµ‹è¯•
4. **test_resource_exhaustion** - èµ„æºè€—å°½æµ‹è¯•

### åˆå§‹åŒ–æµ‹è¯• (5ä¸ª)
1. **test_successful_initialization** - æˆåŠŸåˆå§‹åŒ–æµ‹è¯•
2. **test_different_active_levels** - ä¸åŒæ¿€æ´»ç”µå¹³æµ‹è¯•
3. **test_custom_parameters** - è‡ªå®šä¹‰å‚æ•°æµ‹è¯•
4. **test_multiple_button_initialization** - å¤šæŒ‰é”®åˆå§‹åŒ–æµ‹è¯•


## æ–°å¢åŠŸèƒ½ï¼šä½åŠŸè€—çŠ¶æ€é‡ç½®

### åŠŸèƒ½æ¦‚è¿°
ä¸ºäº†è§£å†³ä½åŠŸè€—æ¨¡å¼ä¸‹æŒ‰é”®çŠ¶æ€æ®‹ç•™é—®é¢˜ï¼Œæ–°å¢äº† `bits_button_reset_states()` å‡½æ•°ã€‚è¯¥åŠŸèƒ½ä¸“é—¨ç”¨äºåœ¨ç³»ç»Ÿä»ä½åŠŸè€—æ¨¡å¼æ¢å¤æ—¶é‡ç½®æ‰€æœ‰æŒ‰é”®çŠ¶æ€ã€‚

### æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®Œæ•´çŠ¶æ€é‡ç½®**ï¼šé‡ç½®æ‰€æœ‰å•æŒ‰é”®å’Œç»„åˆæŒ‰é”®çš„çŠ¶æ€åˆ°ç©ºé—²çŠ¶æ€
- âœ… **ç‰©ç†çŠ¶æ€åŒæ­¥**ï¼šè‡ªåŠ¨è¯»å–å½“å‰ç‰©ç†æŒ‰é”®çŠ¶æ€å¹¶åŒæ­¥è½¯ä»¶çŠ¶æ€
- âœ… **é˜²æ­¢è™šå‡äº‹ä»¶**ï¼šé¿å…çŠ¶æ€é‡ç½®åäº§ç”Ÿæ„å¤–çš„æŒ‰é”®é‡Šæ”¾äº‹ä»¶
- âœ… **ç¼“å†²åŒºæ¸…ç†**ï¼šæ¸…ç©ºæ‰€æœ‰å¾…å¤„ç†çš„æŒ‰é”®äº‹ä»¶

### ä½¿ç”¨åœºæ™¯
```c
void enter_low_power_mode(void) {
    stop_button_scan_timer();    // åœæ­¢æŒ‰é”®æ‰«æ
    enter_sleep_mode();          // è¿›å…¥ä½åŠŸè€—æ¨¡å¼
}

void exit_low_power_mode(void) {
    exit_sleep_mode();           // é€€å‡ºä½åŠŸè€—æ¨¡å¼
    bits_button_reset_states();  // ğŸ”‘ é‡ç½®æŒ‰é”®çŠ¶æ€
    start_button_scan_timer();   // æ¢å¤æŒ‰é”®æ‰«æ
}
```

### æµ‹è¯•éªŒè¯
- **test_state_reset_functionality**: éªŒè¯åŸºç¡€çŠ¶æ€é‡ç½®åŠŸèƒ½
- **test_combo_button_reset**: ä¸“é—¨éªŒè¯ç»„åˆæŒ‰é”®çŠ¶æ€é‡ç½®åŠŸèƒ½

## æŒ‰é”®å€¼ç¼–ç è§„å¾‹

BitsButtonåº“ä½¿ç”¨ä½æ¨¡å¼ç¼–ç æŒ‰é”®å€¼ï¼š
- **å•å‡»**: `0b010` (0x2)
- **åŒå‡»**: `0b01010` (0xA) 
- **ä¸‰è¿å‡»**: `0b101010` (0x2A)
- **å››è¿å‡»**: `0b10101010` (0xAA)
- **äº”è¿å‡»**: `0b1010101010` (0x2AA)
- **é•¿æŒ‰**: `0b011` (0x3)

ç¼–ç è§„å¾‹ï¼šNè¿å‡» = (N-1) Ã— `010` + `10`

## å¿«é€Ÿå¼€å§‹

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# Windows
.\run_tests.bat

# Linux/macOS  
./test/scripts/run_tests.sh
```

### æ¸…ç†é‡å»º
```bash
.\run_tests.bat clean
```

### æ‰‹åŠ¨æ„å»º
```bash
cd test
mkdir build
cd build
cmake ..
make
./run_tests_new
```

## é…ç½®è¯´æ˜

### æµ‹è¯•é…ç½® (test/config/test_config.h)
```c
#define MAX_TEST_EVENTS 100        // æœ€å¤§æµ‹è¯•äº‹ä»¶æ•°
#define TEST_TIMEOUT_MS 5000       // æµ‹è¯•è¶…æ—¶æ—¶é—´
#define DEBOUNCE_TIME_MS 20        // æ¶ˆæŠ–æ—¶é—´
#define LONG_PRESS_TIME_MS 1000    // é•¿æŒ‰æ—¶é—´
#define DOUBLE_CLICK_TIME_MS 300   // åŒå‡»æ—¶é—´çª—å£
```

## æµ‹è¯•å·¥å…·

### æ¨¡æ‹Ÿå·¥å…·
- `simulate_key_press(id, state)` - æ¨¡æ‹ŸæŒ‰é”®çŠ¶æ€
- `reset_test_state()` - é‡ç½®æµ‹è¯•çŠ¶æ€
- `bits_btn_ticks(count)` - æ¨¡æ‹Ÿæ—¶é—´æµé€

### æ–­è¨€å·¥å…·
- `ASSERT_EVENT_WITH_VALUE(id, event, value)` - éªŒè¯äº‹ä»¶å’Œå€¼
- `ASSERT_NO_EVENT(id, event)` - éªŒè¯äº‹ä»¶ä¸å­˜åœ¨
- `ASSERT_EVENT_COUNT(id, event, count)` - éªŒè¯äº‹ä»¶æ•°é‡

## æŒç»­é›†æˆ

æµ‹è¯•æ¡†æ¶æ”¯æŒå¤šç§CIç¯å¢ƒï¼š
- GitHub Actions
- æœ¬åœ°å¼€å‘ç¯å¢ƒ
- Windows/Linux/macOSè·¨å¹³å°

## è´¡çŒ®æŒ‡å—

1. æ·»åŠ æ–°æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè¯·éµå¾ªç°æœ‰çš„å‘½åè§„èŒƒ
2. ç¡®ä¿æµ‹è¯•ç”¨ä¾‹æœ‰æ¸…æ™°çš„æ³¨é‡Šå’Œé¢„æœŸç»“æœ
3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶ç¡®ä¿æ— å›å½’
4. æ›´æ–°ç›¸å…³æ–‡æ¡£

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ç¼–è¯‘é”™è¯¯**: æ£€æŸ¥CMakeç‰ˆæœ¬å’Œç¼–è¯‘å™¨é…ç½®
2. **æµ‹è¯•å¤±è´¥**: æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼Œæ£€æŸ¥æœŸæœ›å€¼æ˜¯å¦æ­£ç¡®
3. **æ€§èƒ½é—®é¢˜**: è°ƒæ•´æµ‹è¯•é…ç½®ä¸­çš„è¶…æ—¶å‚æ•°

### è°ƒè¯•æŠ€å·§
- ä½¿ç”¨ `printf` è°ƒè¯•è¾“å‡ºæŸ¥çœ‹ä¸­é—´çŠ¶æ€
- æ£€æŸ¥äº‹ä»¶ç¼“å†²åŒºçŠ¶æ€
- éªŒè¯æ—¶åºå‚æ•°è®¾ç½®

## ç”¨æˆ·æŒ‡å—å‚è€ƒ

å¦‚éœ€äº†è§£æµ‹è¯•æ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•å’Œåº”ç”¨åœºæ™¯ï¼Œè¯·å‚é˜…ä¸»é¡¹ç›®çš„ç”¨æˆ·æ–‡æ¡£ï¼š

- [æµ‹è¯•æ¡†æ¶ä½¿ç”¨æŒ‡å—](../docs/testing.md)
- [ä½¿ç”¨æŒ‡å—](../docs/usage_guide.md)

---
