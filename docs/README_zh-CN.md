<h1 align="center">BitsButton</h1>

<p align="center">
<a href="https://github.com/530china/EmbeddedButton/blob/master/LICENSE" target="blank">
<img src="https://img.shields.io/github/license/rahuldkjain/github-profile-readme-generator?style=flat-square" alt="github-profile-readme-generator license" />
</a>
<a href="https://github.com/530china/EmbeddedButton/stargazers" target="blank">
<img src="https://img.shields.io/github/stars/rahuldkjain/github-profile-readme-generator?style=flat-square" alt="github-profile-readme-generator stars"/>
</a>
<a href="https://github.com/530china/EmbeddedButton/issues" target="blank">
<img src="https://img.shields.io/github/issues/rahuldkjain/github-profile-readme-generator?style=flat-square" alt="github-profile-readme-generator issues"/>
</a>
<a href="https://github.com/530china/EmbeddedButton/pulls" target="blank">
<img src="https://img.shields.io/github/issues-pr/rahuldkjain/github-profile-readme-generator?style=flat-square" alt="github-profile-readme-generator pull-requests"/>
</a>
</p>

<h2>ğŸ‘‹ ç®€ä»‹</h2>
Bits Buttonæ˜¯ä¸€ä¸ªé«˜æ•ˆã€çµæ´»çš„æŒ‰é”®äº‹ä»¶æ£€æµ‹åº“ï¼Œä¸“ä¸ºåµŒå…¥å¼ç³»ç»Ÿè®¾è®¡ã€‚å®ƒæ”¯æŒä»ç®€å•æŒ‰é”®æ£€æµ‹åˆ°å¤æ‚æŒ‰é”®åºåˆ—è¯†åˆ«çš„å„ç§åœºæ™¯ï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦å¤„ç†ç»„åˆæŒ‰é”®å’Œå¤æ‚æŒ‰é”®åºåˆ—çš„åº”ç”¨ï¼›

## ğŸŒ± ç‰¹æ€§


> 1.ä½¿ç”¨Cè¯­è¨€å®ç°ï¼Œå·§å¦™åˆ©ç”¨ä½è¿ç®—æ¥å®ç°æ¯ä¸ªæŒ‰é”®é”®å€¼çš„äºŒè¿›åˆ¶è®°å½•è¡¨ç¤ºï¼Œ1ä»£è¡¨æŒ‰ä¸‹ï¼Œ0ä»£è¡¨æ¾å¼€

é”®å€¼ | è¯´æ˜
--- | ---
0b0 | æœªæŒ‰ä¸‹
0b010 | å•å‡»
0b01010 | åŒå‡»
0b01010...n | nè¿å‡»
0b011 | é•¿æŒ‰å¼€å§‹
0b0111| é•¿æŒ‰ä¿æŒ
0b01110|é•¿æŒ‰ç»“æŸ
0b01011|çŸ­æŒ‰ç„¶åé•¿æŒ‰
0b0101011 | åŒå‡»ç„¶åé•¿æŒ‰
0b01010..n11 | nè¿å‡»ç„¶åé•¿æŒ‰

> 2.â€‹â€‹ç»„åˆæŒ‰é”®æ”¯æŒ
- è½»æ¾å®šä¹‰ä»»æ„æŒ‰é”®ç»„åˆï¼ˆå¦‚ Ctrl+Cï¼‰
- æ™ºèƒ½å¤„ç†ç»„åˆé”®ä¸å•é”®çš„å†²çªæ£€æµ‹
- å¯é…ç½®ç»„åˆé”®çš„æŠ‘åˆ¶ç­–ç•¥ï¼ˆé˜»æ­¢è§¦å‘ç»„åˆå†…çš„å•é”®äº‹ä»¶ï¼‰

> 3.åºåˆ—æŒ‰é”®æ£€æµ‹ï¼š
- è¯†åˆ«å¤æ‚æŒ‰é”®åºåˆ—ï¼ˆå¦‚ å•å‡»-é•¿æŒ‰-åŒå‡»ï¼‰
- æ”¯æŒæŒ‰é”®åºåˆ—çš„äºŒè¿›åˆ¶ç¼–ç è¡¨ç¤ºï¼ˆå¦‚ 0b1011101010ï¼‰
- çŠ¶æ€æœºé©±åŠ¨çš„åºåˆ—è¯†åˆ«é€»è¾‘ï¼›

> 4.â€‹â€‹â€‹å®Œæ•´æŒ‰é”®äº‹ä»¶ç”Ÿå‘½å‘¨æœŸï¼ˆå¤šç§æŒ‰é”®äº‹ä»¶ç±»å‹ï¼‰â€‹â€‹
- æŒ‰é”®æŒ‰ä¸‹/æŠ¬èµ·äº‹ä»¶
- å•å‡»ã€åŒå‡»ã€å¤šè¿å‡»è¯†åˆ«
- é•¿æŒ‰å¼€å§‹/ç»“æŸ/å‘¨æœŸæ€§è§¦å‘
- çŠ¶æ€å®Œæˆäº‹ä»¶

> 5.â€‹â€‹é«˜æ€§èƒ½äº‹ä»¶é˜Ÿåˆ—
- æ— é”ç¯å½¢ç¼“å†²åŒºè®¾è®¡ï¼ˆFIFOï¼‰
- çº¿ç¨‹å®‰å…¨çš„å•ç”Ÿäº§è€…/å•æ¶ˆè´¹è€…(SPSC)æ¨¡å‹â€‹
- å¯é…ç½®çš„ç¼“å†²åŒºå¤§å°
- ç¼“å†²åŒºæº¢å‡ºæ£€æµ‹ä¸ç»Ÿè®¡
![alt text](image-1.png)

> 6.â€‹â€‹æ¨¡å—åŒ–æ¶æ„
- ä½è¿ç®—ä¼˜åŒ–å¤„ç†é€»è¾‘
- çŠ¶æ€æœºé©±åŠ¨çš„äº‹ä»¶å¤„ç†
- åŸå­æ“ä½œæ”¯æŒå¤šçº¿ç¨‹ç¯å¢ƒ

> 7.â€‹é«˜åº¦å¯é…ç½®
- çŠ¶æ€æœºé©±åŠ¨çš„æ ¸å¿ƒé€»è¾‘
- ç¡¬ä»¶æŠ½è±¡å±‚è®¾è®¡ï¼ˆHALï¼‰
- å¯æ’æ‹”çš„è°ƒè¯•æ¥å£

## æ ¸å¿ƒæ•°æ®ç»“æ„

```c
// å•æŒ‰é”®å¯¹è±¡
typedef struct {
    uint16_t key_id;             // å”¯ä¸€æŒ‰é”®ID
    button_param_t *param;      // æŒ‰é”®å‚æ•°
    btn_state_t current_state;   // å½“å‰çŠ¶æ€
    uint32_t state_bits;         // çŠ¶æ€åºåˆ—ä½å›¾
} button_obj_t;

// ç»„åˆæŒ‰é”®å¯¹è±¡
typedef struct {
    uint16_t key_count;          // ç»„åˆä¸­æŒ‰é”®æ•°é‡
    uint16_t key_single_ids[BITS_BTN_MAX_COMBO_KEYS]; // æˆå‘˜æŒ‰é”®ID
    button_obj_t btn;            // ç»„åˆæŒ‰é”®çŠ¶æ€
    button_mask_type_t combo_mask; // ç»„åˆæ©ç 
    bool suppress;               // æ˜¯å¦æŠ‘åˆ¶æˆå‘˜æŒ‰é”®äº‹ä»¶
} button_obj_combo_t;

// æŒ‰é”®äº‹ä»¶ç»“æœ
typedef struct {
    uint16_t key_id;             // è§¦å‘æŒ‰é”®ID
    btn_state_t event;           // æŒ‰é”®äº‹ä»¶ç±»å‹
    uint16_t long_press_period_trigger_cnt; // é•¿æŒ‰å‘¨æœŸè®¡æ•°
    key_value_type_t key_value;  // æŒ‰é”®å€¼ï¼ˆåºåˆ—ä½å›¾ï¼‰
} bits_btn_result_t;
```

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1ï¼‰ä½¿ç”¨
<details>
<summary>ç‚¹å‡»å±•å¼€/æŠ˜å Cä»£ç <img src="https://media.giphy.com/media/WUlplcMpOCEmTGBtBW/giphy.gif" width="30"></summary>

- [ä½¿ç”¨callbackæ–¹å¼](../examples/example_callback.c);
- [ä½¿ç”¨pollæ–¹å¼](../examples/example_poll.c);
<br></details>

### 2ï¼‰è°ƒè¯•

<details>
<summary>ç‚¹å‡»å±•å¼€/æŠ˜å <img src="https://media.giphy.com/media/WUlplcMpOCEmTGBtBW/giphy.gif" width="30"></summary>

- bits_button_initæ—¶ï¼Œæ³¨å†Œå®šä¹‰ä½ çš„æ‰“å°å‡½æ•°ï¼š
```c
int my_log_printf(const char* format, ...) {
    va_list args;
    va_start(args, format);
    int result = vprintf(format, args);
    va_end(args);
    return result;
}

bits_button_init(
    btns,
    ARRAY_SIZE(btns),
    btns_combo,
    ARRAY_SIZE(btns_combo),
    read_key_state,
    bits_btn_result_cb,
    my_log_printf
);
```
<br></details>

## âš¡ å…¶ä»–
- æœ¬é¡¹ç›®åŸºäºæœ¬äººå®é™…å¼€å‘ä¸­é‡åˆ°çš„ä¸€äº›æŒ‰é”®é©±åŠ¨ä½¿ç”¨ä½“éªŒé—®é¢˜ï¼Œåœ¨ä»–äººé¡¹ç›®ï¼ˆè§å‚è€ƒé“¾æ¥ï¼‰çš„æ€æƒ³åŸºç¡€ä¸Šï¼Œå¼€å‘çš„æ­¤æŒ‰é”®æ£€æµ‹æ¡†æ¶ï¼Œæ„Ÿè°¢å¸®åŠ©æ€è€ƒæˆ‘çš„å°ä¼™ä¼´[shawnfeng0](https://github.com/shawnfeng0)ä»¥åŠæ­£åœ¨ä½¿ç”¨æ­¤æ¨¡å—çš„å°ä¼™ä¼´ï¼Œæ¬¢è¿ä¸€èµ·å¼€å‘æ”¹è¿›ï¼
- æ›´å¤šé«˜çº§ç”¨æ³•è§ [æŒ‰é”®æ¨¡æ‹Ÿå™¨](../examples/ButtonSimulator.md)

TODO:
- [ ] æŒ‰é”®æ¨¡æ‹Ÿå™¨linuxç¯å¢ƒæ”¯æŒï¼›
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹æ”¯æŒï¼›

## ğŸ’¬ å‚è€ƒé“¾æ¥
- [MultiButton](https://github.com/0x1abin/MultiButton)
- [FlexibleButton](https://github.com/murphyzhao/FlexibleButton/tree/master)
- [å®‰å¯Œè±æŒ‰é”®FIFOæ€æƒ³](https://www.armbbs.cn/forum.php?mod=viewthread&tid=111527&highlight=%B0%B4%BC%FC)
- [easy_button](https://github.com/bobwenstudy/easy_button#)