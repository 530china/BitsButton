# 模拟器使用指南

模拟器是一个用于在PC端模拟硬件按键行为的工具，无需实际硬件即可验证按键检测逻辑，特别适合开发和测试阶段。

> 🔍 **了解更多**：如需深入了解模拟器的技术实现细节，请参阅 [模拟器技术实现文档](../simulator/ButtonSimulator.md)。



## 功能概述

### 主要功能

- PC端物理按键行为模拟
- 单按键和组合按键测试支持
- 直观的图形界面操作
- 双模式运行（软件模式和硬件模式）
- 可配置按键参数
- 实时事件显示

### 应用场景

- 脱离开发板验证程序逻辑
- 快速原型验证
- 回归测试
- 教学演示

## 安装要求

### 环境要求

- Python 3.6 或更高版本
- tkinter 库（通常随Python一起安装，某些Linux发行版需单独安装）

### 启动方式

```
simulator/
├── run.py                    # 主运行脚本
├── key_bindings.json         # 按键绑定配置
├── adapter_layer/            # 适配层（用于连接Python和C代码）
└── python_simulator/         # Python模拟器实现
```

## 快速开始

### 启动模拟器

```bash
cd simulator
python run.py  # 默认以软件模式运行GUI界面
```

> 💡 **提示**：模拟器有两种运行模式：
> - **软件模式**（默认）：纯Python模拟实现，运行 `python run.py`
> - **硬件模式**：通过动态库与底层交互，运行 `python run.py --mode hardware`

### 基本使用

1. 启动后，界面将显示虚拟按键
2. 点击按键模拟按下/释放
3. 观察底部事件输出面板
4. 尝试组合按键操作

## 配置文件

### 按键绑定配置 (key_bindings.json)

```json
{
  "mappings": [
    {
      "id": "btn1",
      "key": "a",
      "color": "red",
      "btn_number": 0
    },
    {
      "id": "btn2",
      "key": "b",
      "color": "blue",
      "btn_number": 1
    },
    {
      "id": "btn3",
      "key": "c",
      "color": "orange",
      "btn_number": 2
    },
    {
      "id": "btn4",
      "key": "d",
      "color": "yellow",
      "btn_number": 3
    }
  ]
}
```

### 配置参数说明

- `id`: 按键唯一标识符
- `key`: 绑定的键盘按键
- `color`: 按键显示颜色
- `btn_number`: 硬件按钮编号（硬件模式使用）

## 工作原理

模拟器通过适配层与BitsButton库交互，实现Python界面与C库之间的数据交换。

### 数据流向

- 用户界面操作 → 按键状态变化 → 传递给BitsButton库 → 生成事件 → 返回显示

适配层主要负责：
- 将界面的按键操作转换为BitsButton库可识别的格式
- 接收库产生的按键事件并反馈到界面
- 输出调试日志信息

## 高级功能

### 组合按键测试

支持同时按下多个按键测试组合功能：

1. 按住Ctrl键并点击多个按钮
2. 或使用键盘快捷键同时按下
3. 观察组合按键事件输出

### 时序测试

通过精确的时间控制测试各种时序相关的功能：

- 单击/双击区分
- 长按检测
- 消抖功能验证

### 模拟器自动化测试

使用Python脚本对模拟器本身进行自动化按键序列测试，可以用来验证模拟器功能或进行批量测试：

```python
import time
from button_ctrl import ButtonController

controller = ButtonController()

# 模拟按键序列
controller.press_button(1)
time.sleep(0.1)  # 100ms
controller.release_button(1)
time.sleep(0.2)  # 200ms
controller.press_button(1)  # 双击第二下
time.sleep(0.1)
controller.release_button(1)
```

## 双模式运行

模拟器支持两种运行模式，以适应不同的开发和测试需求：

### 软件模式

```bash
python run.py                 # 默认软件模式
python run.py --mode software # 显式指定软件模式
```

软件模式是一种纯Python实现的模拟方案，具有以下特点：

- **无需编译**：直接运行Python代码，无需安装任何编译工具
- **跨平台兼容**：基于Python和tkinter，可在所有支持Python的平台上运行
- **快速启动**：无需编译时间，启动速度更快
- **易于调试**：纯Python代码便于调试和修改
- **适用场景**：适合算法验证、快速原型开发、功能测试等

### 硬件模式

```bash
python run.py --mode hardware # 硬件模式
```

硬件模式通过动态库与底层BitsButton库交互，具有以下特点：

- **真实交互**：与实际的C库进行交互，更接近真实硬件行为
- **编译要求**：需要安装适当的编译工具链（如GCC、MinGW或Xcode）
- **性能优势**：底层库的性能表现更接近实际硬件环境
- **完整功能**：能够测试完整的适配层功能
- **适用场景**：适合性能测试、完整功能验证、与底层库的集成测试等

### 模式选择建议

- **初学者或快速验证**：使用软件模式
- **完整功能测试或性能评估**：使用硬件模式
- **CI/自动化测试**：推荐使用软件模式以减少环境依赖

## 故障排除

### 常见问题

1. **界面无响应**：检查Python Tkinter是否正常安装
2. **事件不显示**：确认适配器正确连接到BitsButton库
3. **按键无效果**：检查配置文件中的按键ID是否匹配

### 调试技巧

- 使用日志输出查看详细事件流
- 检查按键ID映射是否正确
- 验证时序参数设置

## 与真实硬件对比

### 优势

- 无需硬件即可测试
- 可重复的测试场景
- 精确的时序控制
- 低成本快速验证

### 局限性

- 无法完全替代硬件测试
- 没有真实的电气特性
- 需要额外的适配层

## 最佳实践

1. **开发阶段**：使用模拟器进行快速功能验证
2. **回归测试**：集成到自动化测试流程
3. **教学演示**：用于展示按键检测原理
4. **参数调优**：调整时序参数的参考

## 扩展功能

可以通过修改配置文件和适配层来扩展功能：

- 添加更多虚拟按键
- 自定义按键行为
- 集成自动化测试脚本
- 添加数据记录功能

